# 流媒体监控与控制系统

这是一个基于C语言开发的客户端-服务器架构的流媒体监控与控制系统。该系统允许服务器接收客户端的视频流并发送控制命令，实现远程监控和控制功能。

## 功能特点

- **流媒体传输**：客户端可以将RTSP视频流上传到服务器指定的地址
- **双向通信**：基于TCP套接字的可靠通信
- **命令控制**：服务器可以向客户端发送移动控制命令
- **状态监控**：服务器可以请求客户端状态信息
- **多客户端支持**：服务器可同时处理多个客户端连接
- **交互式控制**：服务器提供键盘交互界面进行命令发送

## 系统架构

系统由以下主要组件组成：

1. **服务器端**：
   - 接受客户端连接
   - 处理客户端消息
   - 发送控制命令
   - 提供交互式命令界面

2. **客户端**：
   - 连接到服务器
   - 发送状态信息
   - 接收并执行控制命令
   - 上传视频流

## 通信协议

系统使用基于JSON的通信协议，使用cJSON库进行解析和生成。通讯端口为 **5566**。

主要消息类型包括：

### 客户端到服务器：
- **初始连接消息**：包含客户端请求和RTSP URL
  ```json
  {
    "reason": "init_slam",
    "rtsp_url": "rtsp://admin:admin123456@127.0.0.1:8554/profile1"
  }
  ```
- **状态响应**：包含电池电量、移动状态等信息
  ```json
  {
    "status": "ok",
    "battery": 85,
    "is_moving": false,
    "current_position": "home"
  }
  ```

### 服务器到客户端：
- **上传URL设置**：提供客户端上传视频流的目标地址
  ```json
  {
    "upload_url": "rtmp://192.168.1.100/stream",
    "timestamp": 1745043712
  }
  ```
- **移动控制命令**：指定移动方向和持续时间
  ```json
  {
    "command": "move",
    "direction": "F",
    "duration": 10,
    "timestamp": 1745042985
  }
  ```
- **状态检查命令**：请求客户端发送当前状态
  ```json
  {
    "command": "check_status",
    "timestamp": 1745042990
  }
  ```

## 自动发现功能

系统支持局域网内的自动发现功能，使用广播端口 **5567**：

- 服务器定期广播其IP地址和端口
  ```json
  {
    "server_ip": "192.168.71.187",
    "server_port": 5566
  }
  ```
- 客户端可以监听广播消息自动发现服务器
- 如果自动发现失败，客户端会使用默认设置

这使得系统可以在不需要手动配置的情况下在局域网内工作，特别适合在WiFi局域网环境中调试使用。

## 编译与运行

### 编译

服务器： 
